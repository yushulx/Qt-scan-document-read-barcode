/*! 20210427
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2021, Dynamsoft Corporation 
* Author: Dynamsoft R&D Department
*
* Version: 17.1
*
* Module: addon/camera
* final js: build\addon\dynamsoft.webtwain.addon.camera.js
*/
var Dynamsoft=self.Dynamsoft||{};Dynamsoft.DWT=Dynamsoft.DWT||{};Dynamsoft.aryAddonReadyFun=Dynamsoft.aryAddonReadyFun||[];Dynamsoft.AddonReady=Dynamsoft.AddonReady||function(fn){Dynamsoft.aryAddonReadyFun.push(fn);}; // jshint ignore: line
Dynamsoft.CameraVerInName = '17.1.0.0525';
Dynamsoft.AddonReady(function(DL, nil){if(!DL.product.bHTML5Edition)return; 
/*! Date: 03/05/2021 13:31:11 */!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={ErrorMessage:{OK:{code:0,message:"Successful"},HTTPS_REQUIRED:{code:-4201,message:"HTTPS is required for accessing cameras."},MEDIADEVICES_NOT_IMPL:{code:-4202,message:"The current browser has not implemented the MediaDevices interface."},GETUSERMEDIA_NOT_IMPL:{code:-4203,message:"The current browser has not implemented the getUserMedia interface."},NO_MEMORY:{code:-4204,message:"Not enough memory for this operation."},NO_CAMERA_SELECTED:{code:-4205,message:"No camera is selected."},VIDEO_ELEMENT_REQUIRED:{code:-4206,message:"A Video element is required for this operation."},CAMERA_PLUG_OUT:{code:-4207,message:"The camera is not plugged in."},CAMERA_NOT_OPEN:{code:-4208,message:"The camera is not open."},CAMERA_SETTINGS_NOT_SUPPORT:{code:-4209,message:"The current browser does not support camera settings."},FAILED_GET_USERMEDIA:{code:-4210,message:"Failed to get camera input."},SOURCE_NOT_FOUND:{code:-4211,message:"The camera source can not be found."},VIDEO_NOT_PLAY:{code:-4214,message:"The video must be playing for the capture operation to work."},VIDEO_NOT_STOP:{code:-4215,message:"The video is already playing. Please stop the video before attempting to play it again to a different container."},NO_CAMERA:{code:-4216,message:"No camera is found."}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraViewer=void 0;var r=i(2);Object.defineProperty(t,"CameraViewer",{enumerable:!0,get:function(){return r.CameraViewer}}),i(11),window.Dynamsoft=window.Dynamsoft||{},window.Dynamsoft.CameraViewer=r.CameraViewer},function(e,t,i){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&o[0]?r["return"]:o[0]?r["throw"]||((n=r["return"])&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)r[n]=o[a];return r},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CameraViewer=void 0;var c=i(3),l=i(4),u=i(6),h=i(7),d=s(i(8)),f=s(i(0))["default"].ErrorMessage,p=s(i(9)),v=i(10),m=function(){function e(e,t,i){this._renderManager=null,this._isDrawing=!1,this._iResolution=null,this._camera=null,this._tempCanvas=document.createElement("canvas"),this.errorCode=0,this.errorMessage="Successful.",this._cropArea=[],this._logs="",this._videoContainer=null,this._video=null,this._resultImg=null,this._controlBox=null,this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this.areaFillStyle="rgba(254,180,32,0.3)",this.lineStrokeStyle="rgba(254,180,32,0.9)",this._selectedBoxColor="#fff",this._selectedPoints=[],this.lineWidth=1,this.displayMode="contain",this._polyfill(),this._pub=new h.PublishSubscribe,this._renderManager=new p["default"],this._iResolution={deviceId:t,resolution:i},e&&this.bindUI(document.getElementById(e),!1),this._cameraManageInit(),this._bindEvents()}return e.prototype._bindEvents=function(){var e=this;[["onLog",this._onLog],["onResolutionChanged",this.show],["onCameraChanged",this._cameraChangedHandler],["onCameraSelChanged",this._onCameraSelChanged],["onPlayed",this.webcamResize],["onThrowError",this._throwError],["onParaTypeError",this._throwParaTypeError],["onParaValueError",this._throwParaValueError]].forEach((function(t){e.on(t[0],t[1])})),window.addEventListener("resize",(function(){e.webcamResize()}))},e.prototype._cameraChangedHandler=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._camera&&c.CameraManager.cameraExist(this._camera._cameraInfo,e)?(this.emit("onLog","camera plug out."),[4,this.closeSource()]):[3,2];case 1:t.sent(),this._pub.emit("video-error",f.CAMERA_PLUG_OUT),t.label=2;case 2:return[2]}}))}))},e.prototype._onLog=function(e){this._logs+=e+"\n"},e.prototype._cameraManageInit=function(){this._cameraManager=new c.CameraManager(this._pub)},e.prototype.destroy=function(){this.off("onLog"),this.unbindUI(),this._closeCamera(),this._cameraManager.destroy(),this.unbindRealTimeRender()},e.prototype.getVideoElement=function(){return this._video},e.prototype._throwError=function(e){if(e.code&&e.message)throw this.errorCode=e.code,this.errorMessage=e.message,u.CameraException.cameraException(e)},e.prototype._throwParaTypeError=function(e,t){throw this.errorCode=-4212,this.errorMessage="Argument of type '"+e+"' is not assignable to parameter of type '"+t+"'.",u.CameraException.cameraException({code:this.errorCode,message:this.errorMessage})},e.prototype._throwParaValueError=function(e,t){throw this.errorCode=-4213,this.errorMessage="The argument '"+e+"' is not valid for the parameter '"+t+"'",u.CameraException.cameraException({code:this.errorCode,message:this.errorMessage})},e.prototype.show=function(){this._checkCamera(),this._videoContainer&&"none"==this._videoContainer.style.display&&(this._videoContainer.style.display=""),this.webcamResize()},e.prototype.hidden=function(){return!!this._videoContainer&&"none"==this._videoContainer.style.display},e.prototype.hide=function(){this._videoContainer&&(this._videoContainer.style.display="none")},e.prototype.playDirectly=function(e,t,i,r){return n(this,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n={},this._camera?this._camera.playing()?[3,2]:[4,this._camera.play(t,i)]:[3,4];case 1:return n=o.sent(),[3,3];case 2:n=this._camera._curResolution,o.label=3;case 3:return[3,9];case 4:return(a=this._cameraManager._allCamerasInfo).length?[3,6]:[4,this._cameraManager.getAllCamerasInfo()];case 5:a=o.sent(),this._cameraManager._allCamerasInfo=a,o.label=6;case 6:return[4,this._cameraManager.requestCamera()];case 7:return o.sent(),this._camera=new l.Camera(null,this._video,a,e,this._pub),[4,this._camera.play(t,i)];case 8:n=o.sent(),o.label=9;case 9:return this.setDisplayMode(r),[2,n]}}))}))},e.prototype.playing=function(){return!!this._camera&&this._camera.playing()},e.prototype.paused=function(){return!!this._camera&&this._camera.paused()},e.prototype._closeCamera=function(){this._camera&&(this._camera.destroy(),this._camera=null)},e.prototype._checkCamera=function(){return!!this._camera&&void 0},e.prototype.bindResolutionsSelector=function(e){return!!this._camera&&this._camera.bindResolutionsSelector(e)},e.prototype.unbindResolutionsSelector=function(){return!!this._camera&&this._camera.unbindResolutionsSelector()},e.prototype._polyfill=function(){if(!HTMLCanvasElement.prototype.toBlob)try{Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){for(var r=atob(this.toDataURL(t,i).split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a++)o[a]=r.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}))}})}catch(e){}},e.prototype.webcamResize=function(){if(this._video&&this._cvsDrawArea){var e=this._cvsDrawArea;this.calPixelRatio()&&(e.width=e.clientWidth,e.height=e.clientHeight,this.emit("webcamResize"))}},e.prototype.calPixelRatio=function(){if(this._video&&this._cvsDrawArea){var e=this._video,t=e.videoWidth,i=e.videoHeight,r=e.clientWidth,n=e.clientHeight;if(0===r||0===n)return 0;var o=0;return"cover"===this.displayMode?o=Math.max(r/t,n/i):"contain"===this.displayMode&&(o=Math.min(r/t,n/i)),o===Infinity&&(o=0),this.pixelRatio=o,o}},e.prototype._clearCanvasRect=function(){this._cvsDrawArea&&this._cvsDrawArea.getContext("2d").clearRect(0,0,this._cvsDrawArea.width,this._cvsDrawArea.height)},e.prototype._clearRegionsults=function(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)},e.prototype.bindCameraSelector=function(e){return this._cameraManager.bindCameraSelector(e)},e.prototype.unbindCameraSelector=function(){return this._cameraManager.unbindCameraSelector()},e.prototype._onCameraSelChanged=function(e){var t=this;this.setCurrentCamera(e).then((function(e){t.hide(),e.getResolutions()}))},e.prototype.setCurrentCamera=function(e,t){return n(this,void 0,void 0,(function(){var i;return o(this,(function(r){switch(r.label){case 0:return this._closeCamera(),(i=this._cameraManager._allCamerasInfo)?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:i=r.sent(),r.label=2;case 2:return[4,this._cameraManager.requestCamera()];case 3:return r.sent(),this._camera=new l.Camera(e,this._video,i,t,this._pub),[2,this._camera]}}))}))},e.prototype.getCurrentCamera=function(){return this._camera},e.prototype.on=function(e,t){this._pub.on(e,t.bind(this))},e.prototype.emit=function(e){for(var t,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];(t=this._pub).emit.apply(t,a([e],i))},e.prototype.off=function(e,t){this._pub.off(e,t)},e.prototype.bindUI=function(e,t,i){var r=this;if((void 0===t&&(t=!0),this.unbindUI(),this._licenseCallback)&&0!==this._licenseCallback().errorCode)return!1;if(i!==undefined&&(this.displayMode=i),e){if(""===e.style.position&&(e.style.position="relative"),this._videoContainer=document.createElement("div"),this._videoContainer.setAttribute("class","dynamsoft-cvs-container"),e.appendChild(this._videoContainer),this._video=document.createElement("video"),this._video.setAttribute("class","dynamsoft-video"),this._video.setAttribute("playsinline","true"),this._video.style["object-fit"]=this.displayMode,this._videoContainer.appendChild(this._video),this._camera&&(this._camera._videoEle=this._video),this._cvsDrawArea=document.createElement("canvas"),this._cvsDrawArea.setAttribute("class","dynamsoft-cvs-drawarea"),this._videoContainer.appendChild(this._cvsDrawArea),this._resultImg=document.createElement("img"),this._resultImg.setAttribute("class","dynamsoft-resultImg"),this._videoContainer.appendChild(this._resultImg),t){var n=document.createElement("div");n.setAttribute("class","dynamsoft-cvs-exit dcs-ui-icon dcs-ui-exitMutiple"),this._videoContainer.appendChild(n),n&&n.addEventListener("click",(function(){r.emit("onExitCamera")}))}return this.bindControlBox(),!0}},e.prototype.unbindUI=function(){if(this._clearRegionsults(),this._videoContainer){var e=this._videoContainer.parentNode;e&&e.removeChild(this._videoContainer)}this._videoContainer=null,this._video=null,this._cvsDrawArea=null,this._divScanLight=null,this._divScanLight=null,this._btnClose=null},e.prototype.getImageData=function(){var e=document.createElement("canvas");return this._drawRealCameraArea(e),e.getContext("2d").getImageData(0,0,e.width,e.height)},e.prototype.getBlobData=function(e){if(e=e||this._tempCanvas,this._video)return new Promise((function(t){e.toBlob((function(e){t(e)}))}))},e.prototype.setDisplayMode=function(e){e!==this.displayMode&&(this.displayMode=e,this._video.style.objectFit=e,this.webcamResize())},e.prototype._drawRealCameraArea=function(e){var t=this._video;if(t){var i=e.getContext("2d");if("contain"===this.displayMode)e.width=t.videoWidth,e.height=t.videoHeight,i.drawImage(this._video,0,0);else{var r=this.pixelRatio,n=t.clientWidth/r,o=t.clientHeight/r;e.width=n,e.height=o;var a=Math.max((this._video.videoWidth-n)/2,0),s=Math.max((this._video.videoHeight-o)/2,0);i.drawImage(this._video,a,s,n,o,0,0,n,o)}}},e.prototype.emptyTempCanvas=function(){var e=this._tempCanvas;e.width=0,e.height=0},e.prototype.bindRealTimeRender=function(e){var t=this;if(this.unbindRealTimeRender(),!this._areaDetectFn)return!1;var i=1e3/e;this._isDrawing=!0;return function r(e){t.freeCropTimer=setTimeout((function(){return n(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._isDrawing?[4,this.drawDetectArea()]:[3,2];case 1:t.sent(),r(e),t.label=2;case 2:return[2]}}))}))}),e)}(i),!0},e.prototype.unbindRealTimeRender=function(){clearTimeout(this.freeCropTimer),this._isDrawing=!1,this.webcamResize()},e.prototype.bindAreaDetectFunction=function(e){return!!d["default"].isFunction(e)&&(this._areaDetectFn=e,!0)},e.prototype.bindPerspectiveFunction=function(e){return!!d["default"].isFunction(e)&&(this._perspectiveCallback=e,!0)},e.prototype.bindLicenseCallback=function(e){return!!d["default"].isFunction(e)&&(this._licenseCallback=e,!0)},e.prototype.detectArea=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(i){switch(i.label){case 0:return e=this.getImageData(),t=[],this._areaDetectFn?[4,this._areaDetectFn(e.data,e.width,e.height)]:[3,2];case 1:t=i.sent(),e=null,i.label=2;case 2:return[2,t.slice(0)]}}))}))},e.prototype.perspective=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(i){return Array.isArray(e)?(t=this.getImageData(),this._perspectiveCallback?[2,this._perspectiveCallback.call(this,t.data,e,t.width,t.height)]:[2]):[2,!1]}))}))},e.prototype.drawDetectArea=function(){return n(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.detectArea()];case 1:return e=t.sent(),Array.isArray(e)&&e.length&&this._isDrawing?(this._drawArea(e),[2,!0]):[2,!1]}}))}))},e.prototype.drawSelectedArea=function(e){if(this._selectedPoints=e.slice(),this._cvsDrawArea){var t=this._cvsDrawArea.getContext("2d");this._clearCanvasRect(),this._processPoints(e);for(var i=0;i<8;i+=2){var r=e[i],n=e[i+1],o=e[(i+2)%8],a=e[(i+3)%8];this._drawLine([r,n],[o,a],t),this._drawPoint([r,n],t)}}},e.prototype.setSelectedBoxColor=function(e,t){this._selectedBoxColor=e,t&&this.drawSelectedArea(this._selectedPoints)},e.prototype._drawPoint=function(e,t){var i=e[0],r=e[1];t.save(),t.strokeStyle=this._selectedBoxColor,t.strokeRect(i-4,r-4,8,8),t.restore()},e.prototype._drawLine=function(e,t,i){var r=e[0],n=e[1],o=t[0],a=t[1];i.save(),i.strokeStyle=this._selectedBoxColor,i.beginPath(),i.moveTo(r,n),i.lineTo(o,a),i.stroke(),i.restore()},e.prototype._drawArea=function(e){var t=this._cvsDrawArea;if(t){var i=t.getContext("2d");this._clearCanvasRect(),this._processPoints(e),i.strokeStyle=this.areaFillStyle,i.fillStyle=this.areaFillStyle,i.lineWidth=5,i.clearRect(0,0,t.width,t.height),i.save(),i.beginPath(),i.moveTo(e[0],e[1]);for(var r=2;r<9;r+=2){var n=e[r%8],o=e[(r+1)%8];i.lineTo(n,o)}return i.stroke(),i.closePath(),i.restore(),!0}},e.prototype._processPoints=function(e){for(var t,i=0;i+1<e.length;i+=2){var r=e[i],n=e[i+1];t=this.getDrawPosition(r,n),e[i]=t[0],e[i+1]=t[1]}return e},e.prototype.getDrawPosition=function(e,t){var i=this._cvsDrawArea,r=this.pixelRatio,n=0,o=0;return"contain"===this.displayMode?(n=(i.width-this._video.videoWidth*r)/2,o=(i.height-this._video.videoHeight*r)/2):(n=(i.width-this._video.clientWidth)/2,o=(i.height-this._video.clientHeight)/2),[e=n+e*r,t=o+t*r]},e.prototype.getRealPosition=function(e,t){var i=this.pixelRatio,r=this._cvsDrawArea,n=0,o=0;return"contain"===this.displayMode?(n=(this._video.videoWidth*i-r.width)/2,o=(this._video.videoHeight*i-r.height)/2):(n=(this._video.clientWidth-r.width)/2,o=(this._video.clientHeight-r.height)/2),[e=(n+e)/i,t=(o+t)/i]},e.prototype.bindControlBox=function(e,t){void 0===t&&(t={});var i={blank1:{className:"camera-empty"},captureBtn:{className:"camera-main",iconClass:"dcs-ui-capture",onButtonClick:"onCapture"},detectBtn:{className:"camera-right",iconClass:"dcs-ui-detect",onButtonClick:"onDetect"}};v.mergeJSON(t,i),this.bindCustomBox(e,i)},e.prototype.bindConfirmBox=function(e){this.bindCustomBox(e,{remakeBtn:{className:"camera-left",iconClass:"dcs-ui-previous",onButtonClick:"onRemake"},blank1:{className:"camera-editEmpty"},perspectiveBtn:{className:"camera-right",iconClass:"dcs-ui-next",onButtonClick:"onPerspective"}})},e.prototype.bindSaveBox=function(e,t){void 0===t&&(t={});var i={backBtn:{className:"camera-around",iconClass:"dcs-ui-previous",onButtonClick:"onBack"},blank1:{className:"camera-saveEmpty"},remakeBtn:{className:"camera-around",iconClass:"dcs-ui-delete",onButtonClick:"onRemake"},confirmBtn:{className:"camera-around",iconClass:"dcs-ui-save",onButtonClick:"onConfirm"}};v.mergeJSON(t,i),this.bindCustomBox(e,i)},e.prototype.bindCustomBox=function(e,t,i){var r,n=this;if(!(r=v.isString(e)?document.getElementById(e):e||this._controlBox))return!1;t=t||{};var o={};d["default"].mergeJSON(t,o);var a="<div id='controlwrapper' class='controlwrapper "+d["default"].rValue(i)+"'>";for(var s in o){var c=o[s];c=c||{},a+="<div id='"+s+"' class='"+s+"  "+(d["default"].rValue(c.className)?d["default"].rValue(c.className):"camera-empty")+"'>",a+="<div class='dcs-ui-icon "+d["default"].rValue(c.iconClass)+"'></div>",a+="<text>"+d["default"].rValue(c.text)+"</text>",a+="</div>"}a+="</div>",r.innerHTML=a;var l=function(e){var t=o[e];t=t||{};var i=d["default"].rValue(t.onButtonClick),r=document.getElementById(e);if(!r||!i)return"continue";r.addEventListener("click",(function(){n.emit(i)})),r.addEventListener("touchstart",(function(e){}))};for(var s in o)l(s);document.body.addEventListener("touchstart",(function(){}))},e.prototype.showResultImage=function(e){this._resultImg&&(this._resultImg.style.display="block",this._resultImg.src=e,this._video.style.display="none")},e.prototype.hideResultImage=function(){this._resultImg&&(this._resultImg.style.display="none",this._resultImg.src="",this._video.style.display="")},e.prototype.getSourceList=function(){return this._cameraManager.getAllCamerasInfo()},e.prototype.selectSource=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(i){switch(i.label){case 0:return d["default"].isString(e)||this._throwParaTypeError(r(e),"string"),this._cameraManager._allCamerasInfo&&0!==this._cameraManager._allCamerasInfo.length?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:i.sent(),i.label=2;case 2:return[4,this._cameraManager.requestCamera()];case 3:return i.sent(),(t=this._cameraManager.selectCamera(e))||this.emit("onThrowError",f.SOURCE_NOT_FOUND),[4,this.setCurrentCamera(t)];case 4:return i.sent(),[2,t]}}))}))},e.prototype.getCurrentSource=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){return this._camera?[2,this._camera._cameraInfo]:[2,null]}))}))},e.prototype.closeSource=function(){var e=this;return new Promise((function(t,i){if(e._camera){var r=e._camera._cameraInfo;e._camera.destroy(),e._camera=null,t(r)}else e.emit("onThrowError",f.NO_CAMERA_SELECTED)}))},e.prototype.play=function(e,t,i,a){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){return n=a===undefined?this.displayMode:a?"cover":"contain",e!==undefined&&(d["default"].isElement(e)?this._videoContainer&&e===this._videoContainer.parentNode||(this.playing()&&this.emit("onThrowError",f.VIDEO_NOT_STOP),this.bindUI(e,!1,n)):this._throwParaTypeError(r(e),"HTMLElement")),[2,this.playDirectly(null,t,i,n)]}))}))},e.prototype.capture=function(){return n(this,void 0,void 0,(function(){var e;return o(this,(function(t){return this._camera||this.emit("onThrowError",f.NO_CAMERA_SELECTED),this._video?(this.playing()||this._throwError(f.VIDEO_NOT_PLAY),e=document.createElement("canvas"),this._drawRealCameraArea(e),this.calPixelRatio(),[2,new Promise((function(t,i){e.toBlob((function(i){e.width=0,e.height=0,t(i)}))}))]):(this.emit("onThrowError",f.VIDEO_ELEMENT_REQUIRED),[2])}))}))},e.prototype.pause=function(){this._camera&&this._camera.pause()},e.prototype.stop=function(){this._camera&&(this._clearCanvasRect(),this._camera.stop())},e.prototype.resume=function(){this._camera&&this._camera.resume()},e.prototype.getStatus=function(){return this._camera?this.playing()?this.paused()?"paused":"playing":"stopped":""},e.prototype.getResolution=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._camera?[4,this._camera.getResolutions()]:[3,2];case 1:return[2,e.sent()];case 2:this.emit("onThrowError",f.NO_CAMERA_SELECTED),e.label=3;case 3:return[2]}}))}))},e.prototype.setResolution=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){return this._camera?(d["default"].isObject(e)||this._throwParaTypeError(r(e),"Object"),e.width>0&&e.height>0||this._throwParaValueError(JSON.stringify(e),"resolution"),this.playing()?[2,this._camera.setResolution(e.width,e.height)]:(this._camera._curResolution=e,[2,e])):(this.emit("onThrowError",f.NO_CAMERA_SELECTED),[2])}))}))},e.prototype.getCurrentResolution=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){return this._camera?[2,this._camera._curResolution]:(this.emit("onThrowError",f.NO_CAMERA_SELECTED),[2])}))}))},e}();t.CameraViewer=m},function(e,t,i){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&o[0]?r["return"]:o[0]?r["throw"]||((n=r["return"])&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CameraManager=void 0;var s=a(i(0))["default"].ErrorMessage,c=function(){function e(e){var t=this;this._cameraPermission=!1,this._allCamerasInfo=[],this._selCameraInfo=null,this._cameraSelector=null,this._onCameraSelChange=function(){var e=!0;t._selCameraInfo&&t._cameraSelector.options.length>0&&t._selCameraInfo.deviceId==t._cameraSelector.value&&(e=!1);var i={},r=t._cameraSelector.selectedOptions;e&&(r&&r.length>0?(i.deviceId=r[0].value,i.label=r[0].innerText):i=t._allCamerasInfo[0]),i.deviceId?t._selCameraInfo=i:i=null,e&&t._fireCameraSelChanged(i)},this._pub=e,this._trackCameraDeviceChanged(),this._bindEvents()}return e.prototype.requestCamera=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._checkNavigator(),0===this._allCamerasInfo.length&&this._pub.emit("onThrowError",s.NO_CAMERA),[4,this._checkAllowCamera()];case 1:return e.sent(),[2]}}))}))},e.prototype._checkNavigator=function(){navigator.mediaDevices===undefined&&(location.origin.startsWith("https://")?this._pub.emit("onThrowError",s.MEDIADEVICES_NOT_IMPL):this._pub.emit("onThrowError",s.HTTPS_REQUIRED)),navigator.mediaDevices.getUserMedia===undefined&&this._pub.emit("onThrowError",s.GETUSERMEDIA_NOT_IMPL)},e.prototype._checkAllowCamera=function(){return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(i){switch(i.label){case 0:if(this._cameraPermission)return[2,!1];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}})];case 2:return(e=i.sent())&&(e.getTracks().forEach((function(e){e.stop()})),this._cameraPermission=!0),[3,4];case 3:return t=i.sent(),this._pub.emit("onThrowError",t),[3,4];case 4:return[2]}}))}))},e.prototype._bindEvents=function(){this._pub.on("onCameraSelChange",this._onCameraSelChange.bind(this))},e.prototype._trackCameraDeviceChanged=function(){var e=this;if(navigator.mediaDevices==undefined)return!1;navigator.mediaDevices.ondevicechange=function(t){e._fireCameraChanged(e._allCamerasInfo)}},e.prototype.getAllCamerasInfo=function(){return n(this,void 0,void 0,(function(){var e,t,i,r,n,a,s,c,l;return o(this,(function(o){switch(o.label){case 0:return this._checkNavigator(),[4,this._getVideoDevices()];case 1:if(e=o.sent(),t=!0,e.length==this._allCamerasInfo.length){for(i=0,r=0,n=e;r<n.length;r++)for(a=n[r],s=0,c=this._allCamerasInfo;s<c.length;s++)if((l=c[s]).deviceId==a.deviceId&&l.label==a.label){i++;break}t=i!=e.length}return t&&(this._allCamerasInfo=e,this._renderSelCameraInfo()),[2,Promise.resolve(this._allCamerasInfo)]}}))}))},e.prototype._getVideoDevices=function(){return n(this,void 0,void 0,(function(){var e,t,i,r,n,a,s,c,l;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._checkAllowCamera()];case 1:return o.sent(),[3,3];case 2:return o.sent(),[3,3];case 3:return[4,navigator.mediaDevices.enumerateDevices()];case 4:for(e=o.sent(),t=[],i=0,r=0;r<e.length;r++)if("videoinput"==(n=e[r]).kind){for(a=!1,s=0,c=t;s<c.length;s++)if(c[s].deviceId===n.deviceId){a=!0;break}a||((l={}).deviceId=n.deviceId,l.label=!n.label||/^camera\s[0-9]+$/.test(n.label)?"camera "+i++:n.label,t.push(l))}return[2,t]}}))}))},e.prototype._fireCameraChanged=function(e){this._pub.emit("onCameraChanged",e)},e.prototype.destroy=function(){this.unbindCameraSelector(),this._pub.off("onCameraChanged"),this._selCameraInfo=null},e.prototype._fireCameraSelChanged=function(e){this._pub.emit("onCameraSelChanged",e)},e.prototype._renderSelCameraInfo=function(){var e={},t=null;if(this._cameraSelector){for(var i in e.deviceId=this._cameraSelector.value,e.label=this._cameraSelector.innerText,this._cameraSelector.innerHTML="",this._allCamerasInfo){var r=this._allCamerasInfo[i],n=document.createElement("option");n.value=r.deviceId,n.innerText=r.label,this._cameraSelector.append(n),e.deviceId==r.deviceId&&(t=n)}var o=this._cameraSelector.options;if(!t&&this._selCameraInfo&&o.length)for(var a=0;a<o.length;a++)if(this._selCameraInfo.deviceId==o.item(a).value){t=o.item(a);break}t&&(this._cameraSelector.value=t.value),(e.deviceId||0!=this._allCamerasInfo.length)&&this._onCameraSelChange()}},e.prototype.bindCameraSelector=function(e){var t=this;this.unbindCameraSelector(),this._cameraSelector=e||document.createElement("select"),this._cameraSelector&&(this._cameraSelector.addEventListener("change",(function(){t._pub.emit("onCameraSelChange")})),this._renderSelCameraInfo())},e.prototype.unbindCameraSelector=function(){this._cameraSelector&&(this._cameraSelector.removeEventListener("change",this._onCameraSelChange),this._cameraSelector.innerHTML="",this._cameraSelector=null)},e.cameraExist=function(e,t){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n.deviceId==e.deviceId&&n.label==e.label)return!0}return!1},e.prototype.selectCamera=function(e){if(!e)return null;var t={};if(this._cameraSelector){var i=void 0,n=void 0;if("object"===r(e)){var o=e;o&&(i=o.deviceId,n=o.label)}"string"==typeof e&&(n=i=e);for(var a=this._cameraSelector.options,s=0;s<a.length;s++){if(i==(c=a[s]).value)return t.deviceId=c.value,t.label=c.innerText,this._cameraSelector.value=c.value,t}for(s=0;s<a.length;s++){var c;if(n==(c=a.item(s)).innerText)return t.deviceId=c.value,t.label=c.innerText,this._cameraSelector.value=c.value,t}}if(this._allCamerasInfo)for(var l={deviceId:"",label:""},u=0;u<this._allCamerasInfo.length;u++){var h=this._allCamerasInfo[u];if(e===h.deviceId)return l.deviceId=h.deviceId,l.label=h.label,l}return null},e}();t.CameraManager=c},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,r,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&o[0]?r["return"]:o[0]?r["throw"]||((n=r["return"])&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;var a=o(i(0)),s=i(5),c=a["default"].ErrorMessage,l=function(){function e(e,t,i,r,n){var o=this;this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this._browserInfo={chrome:!1,firefox:!1,safari:!1,mobile:!1},this._isPlugOut=!1,this._resolutionSelector=null,this._cameraInfo=null,this._allCameras=null,this._videoTrack=null,this._allResolutions=[],this._curResolution=null,this._videoEle=null,this._onResolutionSelChange=function(){var e=!0;if(o._curResolution&&o._resolutionSelector.options.length>0&&JSON.stringify(o._curResolution)==o._resolutionSelector.value&&(e=!1),o._resolutionSelector.options.length>0){var t={};if(o._resolutionSelector&&-1!=o._resolutionSelector.selectedIndex){var i=o._resolutionSelector.options[o._resolutionSelector.selectedIndex];t=JSON.parse(i.value)}o.play(t.width,t.height).then((function(){e&&o._fireResolutionChanged(t.width,t.height,t.type)}))["catch"]((function(e){o._fireLog("Play video failed: "+(e.message||e))}))}},this._pub=n,this._initBrowserInfo(r),e?this._cameraInfo=e:(this._cameraInfo={},this._cameraInfo.deviceId="",this._cameraInfo.label=""),t&&(this._videoEle=t),this._allCameras=i,this._pub.on("onResolutionSelChange",this._onResolutionSelChange.bind(this))}return e.prototype.setPlugout=function(){this._isPlugOut=!0},e.prototype._checkPlugout=function(){this._isPlugOut&&this._pub.emit("video-error",c.CAMERA_PLUG_OUT)},e.prototype._initBrowserInfo=function(e){this._browserInfo=e||this._getBrowser()},e.prototype._getBrowser=function(){var e=new s.BrowserDetect;return{safari:"Safari"==e.browser,chrome:"Chrome"==e.browser,firefox:"Firefox"==e.browser,mobile:e.detectmobilebrowser()}},e.prototype._fireResolutionChanged=function(e,t,i){var r={};r.width=e,r.height=t,r.type=i,this._pub.emit("onResolutionChanged",r)},e.prototype._renderSelResolution=function(){var e={},t=null;if(this._resolutionSelector){var i=this._resolutionSelector.options[this._resolutionSelector.selectedIndex];i&&(e=JSON.parse(i.value),this._resolutionSelector.innerHTML="")}if(this._resolutionSelector){for(var r=0,n=this._allResolutions;r<n.length;r++){var o=n[r],a=document.createElement("option");a.value=JSON.stringify(o),a.innerText=o.width+" x "+o.height,this._resolutionSelector.append(a),e.width==o.width&&e.height==o.height&&(t=a)}var s=this._resolutionSelector.options;if(!t&&this._curResolution&&s.length)for(var c=JSON.stringify(this._curResolution),l=0;l<s.length;l++)if(c==s.item(l).value){t=s.item(l);break}t&&(this._resolutionSelector.value=t.value),(e.width||0!=this._allResolutions.length)&&this._onResolutionSelChange()}},e.prototype.bindResolutionsSelector=function(e){var t=this;this.unbindResolutionsSelector(),this._checkPlugout(),this._resolutionSelector=e||document.createElement("select"),this._resolutionSelector&&(this._resolutionSelector.addEventListener("change",(function(){t._pub.emit("onResolutionSelChange")})),this._renderSelResolution())},e.prototype.unbindResolutionsSelector=function(){this._resolutionSelector&&this._resolutionSelector.removeEventListener("change",this._onResolutionSelChange),this._resolutionSelector=null},e.prototype._getResolution=function(e,t,i,o){return r(this,void 0,void 0,(function(){var r,a,s,l,u,h,d,f;return n(this,(function(n){switch(n.label){case 0:this._checkPlugout(),r={},a=null,s=null,n.label=1;case 1:return n.trys.push([1,5,,6]),this._fireLog("request constraints: width="+t+", height="+i),[4,this._getMediaStream(this._getMediaTrackConstraints(e,t,i,o,!1))];case 2:return(a=n.sent())?(document&&document.createElement?s=document.createElement("video"):this._videoEle?s=this._videoEle:this._pub.emit("onThrowError",c.VIDEO_ELEMENT_REQUIRED),l="exact"==o,!this._browserInfo.firefox&&l?[3,4]:(s.srcObject=a,[4,s.play()])):[2,r];case 3:n.sent(),n.label=4;case 4:return r.type=o,l?(u=a.getVideoTracks()[0],(h=u.getConstraints())&&h.width?(r.height=h.height.exact?h.height.exact:h.height,r.width=h.width.exact?h.width.exact:h.width,this._fireLog("Result constraints: "+JSON.stringify(h))):(d=u.getSettings(),r.height=d.height.exact?d.height.exact:d.height,r.width=d.width.exact?d.width.exact:d.width,this._fireLog("Result constraints(getSettings): "+JSON.stringify(d)))):(r.height=s.videoHeight,r.width=s.videoWidth),[3,6];case 5:return f=n.sent(),this._fireLog("_getResolution exception:"+(f.message||f)),[3,6];case 6:return a?(this._browserInfo.firefox&&(s.srcObject=null),[4,a.getTracks().forEach((function(e){e.stop()}))]):[3,8];case 7:n.sent(),a=null,s=null,n.label=8;case 8:return[2,r]}}))}))},e.prototype.getResolutions=function(){return r(this,void 0,void 0,(function(){var e,t,i,r,o,a,s,c,l,u,h,d,f;return n(this,(function(n){switch(n.label){case 0:if(this._allResolutions.length>0)return[2,this._allResolutions];e=[],t=[{width:320,height:240,type:"exact"},{width:640,height:480,type:"exact"},{width:640,height:360,type:"exact"},{width:800,height:600,type:"exact"},{width:1280,height:720,type:"exact"},{width:1920,height:1080,type:"exact"},{width:2560,height:1440,type:"exact"},{width:3840,height:2160,type:"exact"}],i=null,this._allResolutions=[],r=0,o=t,n.label=1;case 1:return r<o.length?(a=o[r],s=a.height,c=a.width,l=a.type,this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,c,s,l)]:[2,null]):[3,6];case 2:return(i=n.sent())&&i.height&&(!i||!i.height||i.height==s&&i.width==c||i.height==c&&i.width==s)?[3,4]:(this._fireLog("getResolutions try to get ideal resolution: "+c+" x "+s),this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,c,s,"ideal")]:[2,null]);case 3:i=n.sent(),n.label=4;case 4:if(i&&i.height){for(u=!1,h=0,d=e;h<d.length;h++)if((f=d[h]).height==i.height&&f.width==i.width){u=!0;break}if(!u){if(this._fireLog("got resolution: "+JSON.stringify(i)),delete i.type,e.push(i),null===this._allResolutions)return[2,null];this._allResolutions.push(i)}}n.label=5;case 5:return r++,[3,1];case 6:return this._renderSelResolution(),[2,e]}}))}))},e.prototype.setResolution=function(e,t){return r(this,void 0,void 0,(function(){return n(this,(function(i){switch(i.label){case 0:return this._checkPlugout(),[4,this.play(e,t)];case 1:return[2,i.sent()]}}))}))},e.prototype.getVideoSettings=function(){return JSON.parse(JSON.stringify(this.videoSettings))},e.prototype.updateVideoSettings=function(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this.play()},e.prototype.destroy=function(){this.unbindResolutionsSelector(),this.stop(),this._cameraInfo=null,this._allCameras=null,this._allResolutions=null,this._videoEle=null},e.prototype.stop=function(){this._videoEle&&this._videoEle.srcObject&&(this._fireLog("======stop video========"),this._videoEle.srcObject.getTracks().forEach((function(e){e.stop()})),this._videoEle.srcObject=null,this._videoTrack=null)},e.prototype.pause=function(){this._videoEle&&this._videoEle.pause()},e.prototype.resume=function(){this._videoEle&&this.paused()&&this.playing()&&this._videoEle.play()},e.prototype.paused=function(){return!!this._videoEle&&this._videoEle.paused},e.prototype.playing=function(){if(this._isPlugOut)return!1;if(this._videoEle&&this._videoEle.srcObject)try{var e=this._videoEle.srcObject;if(e){var t=e.getVideoTracks();if(t&&0!=t.length)return!0}}catch(i){this._fireLog("get video status: "+(i.message||i))}return!1},e.prototype._getMediaTrackConstraints=function(e,t,i,r,n){var o=JSON.parse(JSON.stringify(this.videoSettings));"boolean"==typeof o.video&&(o.video={});var a="exact"==r;if(t&&(o.video.width=a?{exact:t}:{ideal:t}),i&&(o.video.height=a?{exact:i}:{ideal:i}),n&&(t&&(o.video.width={ideal:t}),i&&(o.video.height={ideal:i})),this._browserInfo.mobile&&this._browserInfo.safari&&n&&(o.video.width=o.video.height,delete o.video.height),e)delete o.video.facingMode,o.video.deviceId={exact:e};else if(o.video.facingMode){var s=o.video.facingMode;if(s instanceof Array&&s.length&&(s=s[0]),"environment"===(s=s.exact||s.ideal||s)&&this._allCameras){for(var c=0,l=this._allCameras;c<l.length;c++){var u=l[c],h=u.label.toLowerCase();if(h&&-1!=h.indexOf("facing back")&&/camera[0-9]?\s0,/.test(h)){delete o.video.facingMode,o.video.deviceId={ideal:u.deviceId};break}}o.bFmEnvironment=!!o.video.facingMode}}return o},e.prototype._getMediaStream=function(e,t){return r(this,void 0,void 0,(function(){var i;return n(this,(function(r){switch(r.label){case 0:this._fireLog("======try getUserMedia========"),"boolean"==typeof e.video&&(e.video={}),this._fireLog("ask "+JSON.stringify(e.video.width)+"x"+JSON.stringify(e.video.height)),r.label=1;case 1:return r.trys.push([1,3,,4]),this._fireLog(e),[4,navigator.mediaDevices.getUserMedia(e)];case 2:return[2,r.sent()];case 3:if(i=r.sent(),this._fireLog(i),i.name&&"OverconstrainedError"==i.name){if(t)throw i;return[2,null]}return this._fireLog("======try getUserMedia again========"),this._browserInfo.mobile&&this._browserInfo.safari?(delete e.video.width,delete e.video.height):e.bFmEnvironment?(delete e.video.facingMode,this._allCameras&&this._allCameras.length&&(e.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):e.video=!0,this._fireLog(e),[2,navigator.mediaDevices.getUserMedia(e)];case 4:return[2]}}))}))},e.prototype._supportedResolution=function(e,t){for(var i=0,r=this._allResolutions;i<r.length;i++){var n=r[i];if(n.height==t&&n.width==e)return n.type}return"ideal"},e.prototype.play=function(e,t){return r(this,void 0,void 0,(function(){var i,r,o,a,s,l,u,h,d;return n(this,(function(n){switch(n.label){case 0:this._videoEle||this._pub.emit("onThrowError",c.VIDEO_ELEMENT_REQUIRED),"number"==typeof e&&e>0&&"number"==typeof t&&t>0||(e=this._curResolution?this._curResolution.width:1280,t=this._curResolution?this._curResolution.height:720),i=this._supportedResolution(e,t),this._checkPlugout(),this.stop(),this._fireLog("======before video========"),this.videoSettings=this._getMediaTrackConstraints(this._cameraInfo.deviceId,e,t,i,!0),r=this.videoSettings,o=null,a={},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._getMediaStream(r,!0)];case 2:return(o=n.sent())&&(s=o.getVideoTracks()).length&&(this._videoTrack=s[0],a=this._videoTrack.getSettings(),l={deviceId:a.deviceId,label:this._videoTrack.label},this._cameraInfo=l),[3,4];case 3:return u=n.sent(),this._fireLog("======get user media exception========"+(u.message||u)),"NotAllowedError"===u.name||"Permission denied"===u.message?this._pub.emit("onThrowError",c.CAMERA_NOT_OPEN):this._pub.emit("onThrowError",c.FAILED_GET_USERMEDIA),[3,4];case 4:this._videoEle.srcObject=o,this._fireLog("======play video========"),n.label=5;case 5:return n.trys.push([5,7,,10]),[4,this._videoEle.play()];case 6:return n.sent(),[3,10];case 7:return h=n.sent(),this._fireLog("======play video exception========"+(h.message||h)),[4,new Promise((function(e){setTimeout(e,1e3)}))];case 8:return n.sent(),[4,this._videoEle.play()];case 9:return n.sent(),[3,10];case 10:return this._fireLog("======after played video========"),d={width:this._videoEle.videoWidth,height:this._videoEle.videoHeight},a.width&&a.height&&(a.width===e&&a.height===t||a.width===t&&a.height===e)&&(d.width=e,d.height=t),this._curResolution=d,this._pub.emit("onPlayed"),[2,d]}}))}))},e.prototype.getCapabilities=function(){return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}},e.prototype.getCameraSettings=function(){return this._videoTrack.getSettings()},e.prototype.getConstraints=function(){return this._videoTrack.getConstraints()},e.prototype._throwNotSupportException=function(){this._pub.emit("onThrowError",c.CAMERA_SETTINGS_NOT_SUPPORT)},e.prototype._fireLog=function(e){this._pub.emit("onLog",e)},e.prototype.applyConstraints=function(e){return r(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this._videoTrack.applyConstraints||this._throwNotSupportException(),[4,this._videoTrack.applyConstraints(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.turnOnTorch=function(){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!0}]})]:[3,2];case 1:return[2,e.sent()];case 2:this._throwNotSupportException(),e.label=3;case 3:return[2]}}))}))},e.prototype.turnOffTorch=function(){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!1}]})]:[3,2];case 1:return[2,e.sent()];case 2:this._throwNotSupportException(),e.label=3;case 3:return[2]}}))}))},e.prototype.setColorTemperature=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=this.getCapabilities().colorTemperature)||this._throwNotSupportException(),e<t.min?e=t.min:e>t.max&&(e=t.max),[4,this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]})];case 1:return[2,i.sent()]}}))}))},e.prototype.setExposureCompensation=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=this.getCapabilities().exposureCompensation)||this._throwNotSupportException(),e<t.min?e=t.min:e>t.max&&(e=t.max),[4,this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})];case 1:return[2,i.sent()]}}))}))},e.prototype.setZoom=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=this.getCapabilities().zoom)||this._throwNotSupportException(),e<t.min?e=t.min:e>t.max&&(e=t.max),[4,this._videoTrack.applyConstraints({advanced:[{zoom:e}]})];case 1:return[2,i.sent()]}}))}))},e.prototype.setFrameRate=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=this.getCapabilities().frameRate)||this._throwNotSupportException(),e<t.min?e=t.min:e>t.max&&(e=t.max),[4,this._videoTrack.applyConstraints({width:{ideal:Math.max(this._videoEle.videoWidth,this._videoEle.videoHeight)},frameRate:e})];case 1:return[2,i.sent()]}}))}))},e}();t.Camera=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserDetect=void 0;var r=function(){function e(){this.dataBrowser=[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],this.dataOS=[{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],this.init()}return e.prototype.init=function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS"},e.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var i=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},e.prototype.searchVersion=function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},e.prototype.detectmobilebrowser=function(){var e=window,t=navigator.userAgent||navigator.vendor||e.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))return!0;if(null!==t.match(/Macintosh/i)){var i=document.createElement("canvas");if(null!==i){var r=i.getContext("webgl")||i.getContext("experimental-webgl");if(r){var n=r.getExtension("WEBGL_debug_renderer_info");if(n)if(-1!==r.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Apple"))return!0}}}return!1},e}();t.BrowserDetect=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraException=void 0;var r=function(){function e(){}return e.cameraException=function(e,t){var i={};return(i=new Error(t||e.message)).code=e.code,i},e}();t.CameraException=r},function(e,t,i){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)r[n]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.PublishSubscribe=void 0;var n=function(){function e(){this._events=[]}return e.prototype.on=function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},e.prototype.emit=function(e){for(var t,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=this._events[e];if(!o||0===o.length)return!1;for(var a=o.length,s=0;s<a;s++)(t=o[s]).call.apply(t,r([null],i))},e.prototype.off=function(e,t){var i=this._events[e];if(!i)return!1;if(t)for(var r=i.length,n=0;n<r;n++){i[n]===t&&i.splice(n,1)}else i&&(i.length=0)},e}();t.PublishSubscribe=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},isElement:function(e){return e instanceof HTMLElement},mergeJSON:function(e,t){for(var i in e)t[i]===undefined?t[i]=e[i]:this.isObject(e[i])?this.mergeJSON(e[i],t[i]):t[i]=e[i]},rValue:function(e){return e===undefined?"":e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){this._canvasEl=null,this._video=null};t["default"]=r},function(e,t,i){"use strict";function r(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}function a(e){return"string"==typeof e}function s(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function c(e){return e instanceof HTMLElement||"[object ShadowRoot]"===Object.prototype.toString.call(e)}function l(e,t,i){t===undefined?i.appendChild(e):i.insertBefore(e,t)}function u(e,t,i,r,n){return n=n/180*Math.PI,{x:(e-i)*Math.cos(n)-(t-r)*Math.sin(n)+i,y:(e-i)*Math.sin(n)+(t-r)*Math.cos(n)+r}}Object.defineProperty(t,"__esModule",{value:!0}),t.rotatePoint=t.rotateRect=t.revokeURL=t.createURL=t.pointToPoint=t.formatTime=t.devicePixelRatio=t.requestAnimationFrame=t.checkFocus=t.deepClone=t.uid=t.insertBefore=t.insertAfter=t.getIndexByCallback=t.getIndex=t.exitFullscreen=t.launchFullscreen=t.isFullscreen=t.id=t.preventDefault=t.stopBubble=t.query=t.throttleStable=t.stable=t.throttle=t.mergeUiConfig=t.mergeJSON=t.addEvent=t.addClass=t.setElStyle=t.isElement=t.isIE=t.isMobile=t.isBorder=t.isColor=t.isBoolean=t.isNumber=t.isSize=t.isString=t.isFunction=t.isObject=t.uniqueArray=t.isArray=void 0,t.isArray=r,t.uniqueArray=function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++)e[t]===e[i]&&(e.splice(i,1),i--);return e}},t.isObject=n,t.isFunction=o,t.isString=a,t.isSize=function(e){var t=String(e);return!!/^\d+(px|em)$|^\d+$|^(100|[1-9]?\d(\.\d\d?\d?)?)%$/.test(t)},t.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},t.isBoolean=s,t.isColor=function(e){var t=document.createElement("span");return t.style.background=e,!!t.style.background},t.isBorder=function(e){var t=document.createElement("span");return t.style.border=e,!(!t.style.border&&""!==e)},t.isMobile=function(){return"ontouchstart"in document.documentElement},t.isIE=function(){return document.documentMode!==undefined},t.isElement=c,t.setElStyle=function(e,t){if(a(t))e.style.cssText=t;else for(var i in t)e.style[i]=t[i]},t.addClass=function(e,t){if(!c)return!1;for(var i=0;i<t.length;i++){var r=t[i];if(a(r)&&r)try{e.classList.add(r)}catch(n){0}}return!0},t.addEvent=function(e,t,i,r){if(e)return e.addEventListener(t,i,r),function(){e.removeEventListener(t,i)}},t.mergeJSON=function h(e,t){for(var i in e)t[i]===undefined?t[i]=e[i]:n(e[i])?h(e[i],t[i]):t[i]=e[i]},t.mergeUiConfig=function d(e,t){for(var i in e){var r=e[i],o=t[i];o===undefined?t[i]=e[i]:s(r)&&n(o)?o.visibility=r:n(r)&&n(o)?d(e[i],t[i]):t[i]=e[i]}},t.throttle=function(e,t,i){var r=!0;return function(){var n=this;r&&(r=!1,setTimeout((function(){e.apply(n,i),r=!0}),t))}},t.stable=function(e,t,i){var r,n=this;return void 0===i&&(i=!1),function(){i?e.apply(n):(r&&clearTimeout(r),r=setTimeout((function(){e.apply(n)}),t))}},t.throttleStable=function(e,t){var i=this,r=0,n=null;return function(){var o=+new Date;o-r<t?(clearTimeout(n),n=setTimeout((function(){r=o,e.apply(i)}),t)):(r=o,e.apply(i))}},t.query=function(e){return document.querySelector(e)},t.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():e&&(e.cancelBubble=!0)},t.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},t.id=function(e){return""===e||e===undefined?null:document.getElementById(e)},t.isFullscreen=function(){var e=window.document;return e.fullscreenElement||e.msFullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||!1},t.launchFullscreen=function(e){return e.requestFullscreen?(e.requestFullscreen(),!0):e.mozRequestFullScreen?(e.mozRequestFullScreen(),!0):e.msRequestFullscreen?(e.msRequestFullscreen(),!0):e.oRequestFullscreen?(e.oRequestFullscreen(),!0):e.webkitRequestFullscreen?(e.webkitRequestFullScreen(),!0):(alert("Your browser does not support full screen!"),!1)},t.exitFullscreen=function(){var e=window.document;return e.exitFullScreen?(e.exitFullScreen(),!0):e.mozCancelFullScreen?(e.mozCancelFullScreen(),!0):e.webkitExitFullscreen?(e.webkitExitFullscreen(),!0):e.msExitFullscreen?(e.msExitFullscreen(),!0):void 0},t.getIndex=function(e){for(var t=e.parentNode.children,i=0;i<t.length;i++)if(t[i]===e)return i},t.getIndexByCallback=function(e,t){for(var i=e.parentNode,r=i.children,n=0,a=0;a<r.length;a++){var s=r[a];if(o(t)){if(!t(s,i))continue;if(s===e)return n;n++}else if(s===e)return a}return-1},t.insertAfter=function(e,t){var i=t.parentNode;i.lastChild==t?i.appendChild(e):l(e,t.nextSibling,i)},t.insertBefore=l,t.uid=function(e){var t=Math.random().toString(35).substr(2);return t.length<11&&(t+=Math.random().toString(35).substr(2)),e=Math.max(Math.min(Math.round(e),11),8),t=t.substr(0,e)},t.deepClone=function f(e){var t;if(r(e))t=[];else{if(!n(e))return e;t={}}for(var i in e){var o=e[i];r(e)||n(e)?t[i]=f(o):t[i]=o}return t},t.checkFocus=function(){var e=document.activeElement;return"INPUT"===e.tagName&&"text"===e.type},t.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(i=!1),i)return t(e);var r={},n=1,o=null,a=+new Date;return function(e,t){var i=n++;return r[i]=e,null===o&&(o=setInterval((function(){var e=+new Date,t=r;for(var i in r={},0,t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i](e),a=e);e-a>2500&&(clearInterval(o),o=null)}),1e3/60)),i}(e)},t.devicePixelRatio=function(){var e=window;return e?e.devicePixelRatio?e.devicePixelRatio:e.screen.deviceXDPI&&e.screen.logicalXDPI?e.screen.deviceXDPI/e.screen.logicalXDPI:1:1},t.formatTime=function(e){var t=new Date,i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return e},t.pointToPoint=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},t.createURL=function(e){var t=Object.prototype.toString.call(e),i=window.URL||window.webkitURL;return"[object Blob]"===t?{type:"object",data:i.createObjectURL(e)}:/\[object ArrayBuffer\]|\[object \w+Array\]/.test(t)?{type:"object",data:i.createObjectURL(new Blob([e]))}:(/data:image\/\w+;base64/.test(e),{type:"string",data:e})},t.revokeURL=function(e){var t=window.URL||window.webkitURL;if(/^blob:/.test(e))return t.revokeObjectURL(e)},t.rotateRect=function(e,t,i,r,n){var o=e+i/2,a=t+r/2,s=u(e,t,o,a,n),c=u(e+i,t,o,a,n),l=u(e+i,t+r,o,a,n),h=u(e,t+r,o,a,n),d=[c.x,s.x,h.x,l.x].sort((function(e,t){return e-t})),f=[c.y,s.y,h.y,l.y].sort((function(e,t){return e-t}));return{x:d[0],y:f[0],width:d[3]-d[0],height:f[3]-f[0]}},t.rotatePoint=u},function(e,t,i){}]); 
}); 
Dynamsoft.AddonReady(function(c,b){if(!c.product.bHTML5Edition){return}var a=function(e){var g=c.html5.Funs,d;var f=function(){this._stwain=e;this._viewer=null};f.prototype._getCameraViewer=function(){if(this._viewer==null){this._viewer=new Dynamsoft.CameraViewer();this._stwain._ImgManager.getWebViewer().bindCamera()}return this._viewer};f.prototype._checkLic=function(){var h=true;if(!c.License.checkProductKey(this._stwain,{Webcam:true},true)){h=false}if(h&&!c.License.checkProductKey(this._stwain,{Webcam:true,Wasm:true},true)){h=false}if(h){return false}else{return{code:this._stwain._errorCode,message:this._stwain._errorString}}};f.prototype.getSourceList=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._getCameraViewer().getSourceList()};f.prototype.selectSource=function(h){var i=this._checkLic();if(i){return c.Promise.reject(i)}this._getCameraViewer().hide();return this._getCameraViewer().selectSource(h)};f.prototype.closeSource=function(){var i=this._checkLic();if(i){return c.Promise.reject(i)}this._getCameraViewer().hide();var h=this._getCameraViewer().closeSource();this._stwain._ImgManager.getWebViewer().render();return h};f.prototype.play=function(j,l,p){var k=this._checkLic(),h,o;if(k){return c.Promise.reject(k)}if(this._stwain._ImgManager.getWebViewer()._imageEditorInner&&this._stwain._ImgManager.getWebViewer()._imageEditorInner.bShowImageEditForFullScreen){c.Errors.ImageEditorOpenCannotPlayVideo(this._stwain);return c.Promise.reject({code:this._stwain._errorCode,message:this._stwain._errorString})}var m=j;if(!m){if(this._stwain._ImgManager.getWebViewer().myViewer.bOnlyShowThumbnailsView||!this._stwain._ImgManager.getWebViewer().myViewer.showMain){var n=c.one(["#showImageArea",this._stwain._ImgManager.getWebViewer().GetIdPostfix()].join(""));if(n&&n.length>0){if(n[0].className.indexOf("DVS_disabled")<0){m=n[0]}}}else{var i=c.one(["#container",this._stwain._ImgManager.getWebViewer().GetIdPostfix()].join(""));if(i&&i.length>0){if(i[0].className.indexOf("DVS_disabled")<0){m=i[0]}}}}if(!m){this._getCameraViewer().unbindUI();this._getCameraViewer().closeSource().then(function(){},function(){})}else{if(typeof l=="object"){h=l.width;o=l.height}this._getCameraViewer().show()}return this._getCameraViewer().play(m,h,o,p)};f.prototype.pause=function(){return this._getCameraViewer().pause()};f.prototype.resume=function(){return this._getCameraViewer().resume()};f.prototype.getStatus=function(){return this._getCameraViewer().getStatus()};f.prototype.capture=function(){var i=this._checkLic(),h=this._stwain;if(i){return c.Promise.reject(i)}return this._getCameraViewer().capture().then(function(j){return new c.Promise(function(o,n){var k=j,l=-1,m=Dynamsoft.DWT.EnumDWT_ImageType;if(h._bLocalService){if(c.isString(k.type)){if(k.type=="application/pdf"){l=m.IT_PDF}else{if(k.type=="image/png"){l=m.IT_PNG}else{if(k.type=="image/jpeg"){l=m.IT_JPG}else{if(k.type=="image/bmp"){l=m.IT_BMP}else{if(k.type=="image/tiff"){l=m.IT_TIF}else{if(k.type=="image/jp2"){l=m.IT_J2K}}}}}}}h.__captureImage(k,l,function(){o(k)},function(q,p){n({code:q,message:p})})}else{h._innerSendToMobile("LoadImageFromBinary",[k,true],0,function(){o(k)},function(q,p){n({code:q,message:p})})}})})};f.prototype.stop=function(){this._getCameraViewer().hide();var h=this._getCameraViewer().stop();this._stwain._ImgManager.getWebViewer().SetWidth(this._stwain._ImgManager.getWebViewer().GetWidth());return h};f.prototype.show=function(){return this._getCameraViewer().show()};f.prototype.hide=function(){return this._getCameraViewer().hide()};f.prototype.getCurrentResolution=function(){return this._getCameraViewer().getCurrentResolution()};f.prototype.getCurrentSource=function(){return this._getCameraViewer().getCurrentSource()};f.prototype.getResolution=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._getCameraViewer().getResolution()};f.prototype.setResolution=function(h){var i=this._checkLic();if(i){return c.Promise.reject(i)}return this._getCameraViewer().setResolution(h)};f.prototype.setResolution=function(h){var i=this._checkLic();if(i){return c.Promise.reject(i)}return this._getCameraViewer().setResolution(h)};f.prototype.showVideo=function(j,h,l,i){var k=this._checkLic();if(k){return c.Promise.reject(k)}this._getCameraViewer();return this._stwain._ImgManager.getWebViewer().showVideo(j,h,l,i)};f.prototype.closeVideo=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._stwain._ImgManager.getWebViewer().closeVideo()};f.prototype.on=function(h,i){var j=this;if(h!="video-closed"&&h!="video-error"){c.Errors.EventNotExist(this._stwain);return}if(!c.isFunction(i)){c.Errors.CallbackNotAFunction(j._stwain);return}this._stwain._ImgManager.getWebViewer().on(h,i)};f.prototype.off=function(h,i){if(h!="video-closed"||h!="video-error"){c.Errors.EventNotExist(this._stwain);return}if(c.isUndefined(i)){this._stwain._ImgManager.getWebViewer().off(h)}else{if(!c.isFunction(i)){c.Errors.CallbackNotAFunction(this._stwain);return}this._stwain._ImgManager.getWebViewer().off(h,i)}};e.__addon=e.__addon||{};e.__addon.Camera=new f()};if(c.DynamicLoadAddonFuns){c.DynamicLoadAddonFuns.push(a)}});